var WP_Optimize_Cache=function(){function e(){var e={};return s(".cache-settings").each(function(){var a=s(this),o=a.attr("name");a.is('input[type="checkbox"]')?e[o]=a.is(":checked")?1:0:a.is("textarea")?e[o]=a.val().split("\n"):e[o]=a.val()}),s(".cache-settings-array").each(function(){var a=s(this),o=a.attr("name");e.hasOwnProperty(o)||(e[o]=[]),a.is('input[type="checkbox"]')?"value"==a.data("saveas")?a.is(":checked")&&e[o].push(a.val()):e[o].push(a.is(":checked")?1:0):a.is("textarea")?e[o].push(a.val().split("\n")):e[o].push(a.val())}),e}function a(){var e=n.add_agent({command:"get_cache_preload_status",callback:o,_keep:!1});null!==e&&p.push(e)}function o(e){e.done?(w.val(wpoptimize.run_now),w.data("running",!1)):(w.val(wpoptimize.cancel),w.data("running",!0),a()),h.text(e.message),t(e)}function t(e){s("#wpo_current_cache_size_information").text(wpoptimize.current_cache_size+" "+e.size),s("#wpo_current_cache_file_count").text(wpoptimize.number_of_files+" "+e.file_count)}var s=jQuery,i=wp_optimize.block_ui,r=wp_optimize.send_command,n=WP_Optimize_Heartbeat(),p=[],c=s("#wp_optimize_browser_cache_enable"),_=s("#wp-optimize-purge-cache"),l=s("#enable_page_caching"),d=s("#page_cache_length_value");_.on("click",function(){var e=s(this),o=e.next(),i=o.next();return!e.prop("disabled")&&(e.prop("disabled",!0),o.show(),void r("purge_page_cache",{},function(s){e.prop("disabled",!1),o.hide(),i.show(),setTimeout(function(){i.fadeOut("slow",function(){i.hide()}),a()},5e3),t(s)}))}),s("body").on("wpo_purge_cache",function(){_.trigger("click")}),c.closest("form").on("submit",function(e){return e.preventDefault(),c.trigger("click"),!1}),d.on("change",function(){var e=parseInt(d.val(),10);s('#preload_schedule_type option[value="wpo_use_cache_lifespan"]').prop("disabled",isNaN(e)||e<=0)}),s("#wp_optimize_gzip_compression_enable").on("click",function(){var e=s(this),a=e.next();a.show(),r("enable_gzip_compression",{enable:e.data("enable")},function(o){var t=s("#wpo_gzip_compression_status");o?(o.enabled?(e.text(wpoptimize.disable),e.data("enable","0"),t.removeClass("wpo-disabled").addClass("wpo-enabled")):(e.text(wpoptimize.enable),e.data("enable","1"),t.addClass("wpo-disabled").removeClass("wpo-enabled")),o.message?s("#wpo_gzip_compression_error_message").text(o.message).show():s("#wpo_gzip_compression_error_message").hide(),o.output?s("#wpo_gzip_compression_output").html(o.output).show():s("#wpo_gzip_compression_output").hide()):alert(wpoptimize.error_unexpected_response),a.hide()}).fail(function(){alert(wpoptimize.error_unexpected_response),a.hide()})}),s(".wpo-refresh-gzip-status").on("click",function(e){e.preventDefault(),$link=s(this),$link.addClass("loading"),r("get_gzip_compression_status",null,function(e){$link.removeClass("loading");var a=s("#wpo_gzip_compression_status");e.hasOwnProperty("status")?e.status?a.removeClass("wpo-disabled").addClass("wpo-enabled"):a.addClass("wpo-disabled").removeClass("wpo-enabled"):e.hasOwnProperty("error")&&(alert(e.error),console.log("Gzip status error code: "+e.code),console.log("Gzip status error message: "+e.message))})}),c.on("click",function(){var e=s("#wpo_browser_cache_expire_days"),a=s("#wpo_browser_cache_expire_hours"),o=parseInt(e.val(),10),t=parseInt(a.val(),10),i=s(this),n=i.next();return isNaN(o)&&(o=0),isNaN(t)&&(t=0),o<0||t<0?(s("#wpo_browser_cache_error_message").text(wpoptimize.please_use_positive_integers).show(),!1):t>23?(s("#wpo_browser_cache_error_message").text(wpoptimize.please_use_valid_values).show(),!1):(s("#wpo_browser_cache_error_message").hide(),e.val(o),a.val(t),n.show(),void r("enable_browser_cache",{browser_cache_expire_days:o,browser_cache_expire_hours:t},function(e){var a=s("#wpo_browser_cache_status"),o=s("#wpo_enable_browser_cache");e?(e.enabled?(i.text(wpoptimize.update),a.removeClass("wpo-disabled").addClass("wpo-enabled"),o.val("true")):(i.text(wpoptimize.enable),a.addClass("wpo-disabled").removeClass("wpo-enabled"),o.val("false")),e.message?s("#wpo_browser_cache_message").text(e.message).show():s("#wpo_browser_cache_message").hide(),e.error_message?s("#wpo_browser_cache_error_message").text(e.error_message).show():s("#wpo_browser_cache_error_message").hide(),e.output?s("#wpo_browser_cache_output").html(e.output).show():s("#wpo_browser_cache_output").hide()):alert(wpoptimize.error_unexpected_response),n.hide()}).fail(function(){alert(wpoptimize.error_unexpected_response),n.hide()}))}),s("#wp-optimize-save-cache-settings, #wp-optimize-save-cache-advanced-rules, #wp-optimize-save-cache-preload-settings").on("click",function(){var a=s(this),o=a.next(),t=o.next();o.show(),i(wpoptimize.saving),r("save_cache_settings",{"cache-settings":e()},function(e){if(e.hasOwnProperty("js_trigger")&&s(document).trigger(e.js_trigger,e),e.hasOwnProperty("error")?(console.log(e.error),wp_optimize.notices.show_notice(e.error.code,e.error.message)):s(".wpo-error__enabling-cache").addClass("wpo_hidden").find("p").text(""),e.hasOwnProperty("warnings")){console.log(e.warnings),s(".wpo-warnings__enabling-cache").removeClass("wpo_hidden").find("p").text(e.warnings_label);var a=s(".wpo-warnings__enabling-cache").find("ul").html("");s.each(e.warnings,function(e,o){a.append("<li>"+o+"</li>")})}else s(".wpo-warnings__enabling-cache").addClass("wpo_hidden").find("p").text("");if(e.hasOwnProperty("advanced_cache_file_writing_error")?s("#wpo_advanced_cache_output").text(e.advanced_cache_file_content).show():s("#wpo_advanced_cache_output").hide(),l.prop("checked",e.enabled),l.is(":checked")?(s(".purge-cache").show(),s("#wp_optimize_run_cache_preload").prop("disabled",!1),s("#wp_optimize_run_minify_preload").prop("disabled",!0),s("#minify-preload").show()):(s(".purge-cache").hide(),s("#wp_optimize_run_cache_preload").prop("disabled",!0),s("#wp_optimize_run_minify_preload").prop("disabled",!1),s("#minify-preload").hide()),e.result)t.show(),setTimeout(function(){t.fadeOut("slow",function(){t.hide()})},5e3);else{var o=s(".wp-optimize-nav-tab-contents .notice:visible").closest(".wp-optimize-nav-tab-contents").attr("id"),i="cache";if(/wpo_cache-(.+)-contents/.test(o)){var r=/wpo_cache-(.+)-contents/.exec(o);i=r[1]}s('.wpo-page.active .nav-tab-wrapper a[data-tab="'+i+'"]').trigger("click");var n=s(".wpo-page.active").offset();window.scroll(0,n.top-20)}}).always(function(){s.unblockUI(),o.hide()})}),l.on("change",function(){s(".wpo-error__enabling-cache").addClass("wpo_hidden"),s(".wpo-warnings__enabling-cache").addClass("wpo_hidden"),s("#wpo_advanced_cache_output").hide(),s("#wp-optimize-save-cache-settings").trigger("click")});var w=s("#wp_optimize_run_cache_preload"),h=s("#wp_optimize_preload_cache_status"),u=s("#enable_schedule_preload"),g=s("#preload_schedule_type");u.on("change",function(){u.prop("checked")?g.prop("disabled",!1):g.prop("disabled",!0)}),u.trigger("change"),w.on("click",function(){var e=s(this),o=e.data("running"),t=h.text();e.prop("disabled",!0),o?(e.data("running",!1),n.cancel_agents(p),r("cancel_cache_preload",null,function(e){e&&e.hasOwnProperty("message")&&h.text(e.message)}).always(function(){e.val(wpoptimize.run_now),e.prop("disabled",!1)})):(h.text(wpoptimize.starting_preload),e.data("running",!0),r("run_cache_preload",null,null,!0,{timeout:3e3}).always(function(o){try{var s=wpo_parse_json(o)}catch(i){}if(s&&s.error&&"timeout"!==s.statusText){var r=wpoptimize.error_unexpected_response;return"function"!=typeof s.error?r=s.error:s.status&&(r=s.status+": "+s.statusText),alert(r),h.text(t),e.prop("disabled",!1),void e.data("running",!1)}h.text(wpoptimize.loading_urls),e.val(wpoptimize.cancel),e.prop("disabled",!1),a()}))}),w.data("running")&&a(),s("#wpo-show-avatars").on("change",function(){s(this).is(":checked")?s("#wpo-host-gravatars-locally-container").show():(s("#wpo-host-gravatars-locally").prop("checked",!1),s("#wpo-host-gravatars-locally-container").hide())}),s("#wpo-auto-preload-after-purge").on("click",function(){var e=this,a=s(this).closest(".wpo-fieldgroup__subgroup").find(".dashicons-yes");e.disabled=!0,i(wpoptimize.saving),r("save_cache_auto_preload_option",{enabled:!!e.checked},function(o){e.disabled=!1,s.unblockUI(),o.success?a.show().fadeOut(1e3):(e.checked=!e.checked,alert(o.message))})}),wp_optimize.cache_settings=e};