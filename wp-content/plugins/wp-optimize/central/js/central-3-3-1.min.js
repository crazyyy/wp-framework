function updraftcentral_send_command(e,r,t,a){default_options={json_parse:!0,alert_on_error:!0,action:"updraft_central_ajax",nonce_key:"nonce",timeout:null,async:!0,type:"POST"},"undefined"!=typeof uclion.updraftcentral_request_nonce&&uclion.updraftcentral_request_nonce&&(default_options.nonce=uclion.updraftcentral_request_nonce),"undefined"==typeof a&&(a={});for(var o in default_options)a.hasOwnProperty(o)||(a[o]=default_options[o]);var n={action:a.action,subaction:e};n[a.nonce_key]=a.nonce,n.action_data=r;var l={type:a.type,url:ajaxurl,data:n,success:function(e,r){if(a.json_parse){try{var o=central_parse_json(e)}catch(n){return"function"==typeof a.error_callback?a.error_callback(e,n,502,o):(console.log(n),console.log(e),void(a.alert_on_error&&alert(uclion.unexpectedresponse+" "+e)))}if(o.hasOwnProperty("fatal_error"))return"function"==typeof a.error_callback?a.error_callback(e,r,500,o):(console.error(o.fatal_error_message),a.alert_on_error&&alert(o.fatal_error_message),!1);"function"==typeof t&&t(o,r,e)}else"function"==typeof t&&t(e,r)},error:function(e,r,t){"function"==typeof a.error_callback?a.error_callback(e,r,t):(console.log("updraftcentral_send_command: error: "+r+" ("+t+")"),console.log(e))},dataType:"text",async:a.async};null!=a.timeout&&(l.timeout=a.timeout),jQuery.ajax(l)}function central_parse_json(e,r){if(r="undefined"!=typeof r,!r)try{var t=JSON.parse(e);return t}catch(a){console.log(uclion.plugin_name+": Exception when trying to parse JSON (1) - will attempt to fix/re-parse based upon first/last curly brackets"),console.log(e)}var o=e.indexOf("{"),n=e.lastIndexOf("}");if(o>-1&&n>-1){var l=e.slice(o,n+1);try{var c=JSON.parse(l);return r||console.log(uclion.plugin_name+": JSON re-parse successful"),r?{parsed:c,json_start_pos:o,json_last_pos:n+1}:c}catch(a){console.log(uclion.plugin_name+": Exception when trying to parse JSON (2) - will attempt to fix/re-parse based upon bracket counting");for(var u=o,s=0,i="",d=!1;(s>0||u==o)&&u<=n;){var _=e.charAt(u);d||"{"!=_?d||"}"!=_?'"'==_&&"\\"!=i&&(d=!d):s--:s++,i=_,u++}console.log("Started at cursor="+o+", ended at cursor="+u+" with result following:"),console.log(e.substring(o,u));try{var c=JSON.parse(e.substring(o,u));return console.log(uclion.plugin_name+": JSON re-parse successful"),r?{parsed:c,json_start_pos:o,json_last_pos:u}:c}catch(a){throw a}}}throw uclion.plugin_name+": could not parse the JSON"}jQuery(function(e){function r(e){var r=!!jQuery("#updraftcentral_mothership_other").is(":checked");r?(jQuery("#updraftcentral_keycreate_mothership").prop("disabled",!1),e?jQuery("#updraftcentral_keycreate_mothership_firewalled_container").show():(jQuery(".updraftcentral_wizard_self_hosted_stage2").show(),jQuery("#updraftcentral_keycreate_mothership_firewalled_container").slideDown(),jQuery("#updraftcentral_keycreate_mothership").trigger("focus"))):(jQuery("#updraftcentral_keycreate_mothership").prop("disabled",!0),e||(jQuery(".updraftcentral_wizard_self_hosted_stage2").hide(),t()))}function t(){jQuery("#updraftcentral_wizard_stage1_error").text("");var e="";if(jQuery("#updraftcentral_mothership_updraftpluscom").is(":checked"))jQuery(".updraftcentral_keycreate_description").hide(),e="updraftplus.com";else if(jQuery("#updraftcentral_mothership_other").is(":checked")){jQuery(".updraftcentral_keycreate_description").show();var r=jQuery("#updraftcentral_keycreate_mothership").val();if(""==r)return void jQuery("#updraftcentral_wizard_stage1_error").text(uclion.updraftcentral_wizard_empty_url);try{var t=new URL(r);e=t.hostname}catch(a){if("undefined"==typeof URL&&(e=jQuery("<a>").prop("href",r).prop("hostname")),!e||"undefined"!=typeof URL)return void jQuery("#updraftcentral_wizard_stage1_error").text(uclion.updraftcentral_wizard_invalid_url)}}jQuery("#updraftcentral_keycreate_description").val(e),jQuery(".updraftcentral_wizard_stage1").hide(),jQuery(".updraftcentral_wizard_stage2").show()}e("#updraftcentral_keys").on("click","a.updraftcentral_keys_show",function(r){r.preventDefault(),e(this).remove(),e("#updraftcentral_keys_table").slideDown()}),e("#updraftcentral_keycreate_altmethod_moreinfo_get").on("click",function(r){r.preventDefault(),e(this).remove(),e("#updraftcentral_keycreate_altmethod_moreinfo").slideDown()}),jQuery("#updraftcentral_keys").on("click",'input[type="radio"]',function(){r(!1)}),r(!0),jQuery("#updraftcentral_keys").on("click","#updraftcentral_view_log",function(e){e.preventDefault(),jQuery("#updraftcentral_view_log_container").block({message:'<div style="margin: 8px; font-size:150%;"><img src="'+uclion.central_url+'/images/udlogo-rotating.gif" height="80" width="80" style="padding-bottom:10px;"><br>'+uclion.fetching+"</div>"});try{updraftcentral_send_command("get_log",null,function(e){jQuery("#updraftcentral_view_log_container").unblock(),e.hasOwnProperty("log_contents")?jQuery("#updraftcentral_view_log_contents").html('<div style="border:1px solid;padding: 2px;max-height: 400px; overflow-y:scroll;">'+e.log_contents+"</div>"):console.log(e)},{error_callback:function(e,r,t,a){if(jQuery("#updraftcentral_view_log_container").unblock(),"undefined"!=typeof a&&a.hasOwnProperty("fatal_error"))console.error(a.fatal_error_message),alert(a.fatal_error_message);else{var o="updraftcentral_send_command: error: "+r+" ("+t+")";console.log(o),alert(o),console.log(e)}}})}catch(r){jQuery("#updraft_central_key").html(),console.log(r)}}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_wizard_go",function(e){jQuery("#updraftcentral_wizard_go").hide(),jQuery(".updraftcentral_wizard_success").remove(),jQuery(".create_key_container").show()}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_stage1_go",function(e){e.preventDefault(),jQuery(".updraftcentral_wizard_stage2").hide(),jQuery(".updraftcentral_wizard_stage1").show()}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_stage2_go",function(e){e.preventDefault(),t()}),jQuery("#updraftcentral_keys").on("click","#updraftcentral_keycreate_go",function(e){e.preventDefault();var r=!!jQuery("#updraftcentral_mothership_other").is(":checked"),t=jQuery("#updraftcentral_keycreate_description").val(),a=jQuery("#updraftcentral_keycreate_keysize").val(),o="__updraftpluscom";if(data={key_description:t,key_size:a},r&&(o=jQuery("#updraftcentral_keycreate_mothership").val(),"http"!=o.substring(0,4)))return void alert(uclion.enter_mothership_url);data.mothership_firewalled=jQuery("#updraftcentral_keycreate_mothership_firewalled").is(":checked")?1:0,data.where_send=o,jQuery(".create_key_container").hide(),jQuery(".updraftcentral_wizard_stage1").show(),jQuery(".updraftcentral_wizard_stage2").hide(),jQuery("#updraftcentral_keys").block({message:'<div style="margin: 8px; font-size:150%;"><img src="'+uclion.central_url+'/images/udlogo-rotating.gif" height="80" width="80" style="padding-bottom:10px;"><br>'+uclion.creating_please_allow+"</div>"});try{updraftcentral_send_command("create_key",data,function(e){jQuery("#updraftcentral_keys").unblock();try{if(e.hasOwnProperty("error"))return alert(e.error),void console.log(e);alert(e.r),e.hasOwnProperty("bundle")&&e.hasOwnProperty("keys_guide")?(jQuery("#updraftcentral_keys_content").html(e.keys_guide),jQuery("#updraftcentral_keys_content").append('<div class="updraftcentral_wizard_success">'+e.r+'<br><textarea id="updraftcentral-key" onclick="this.select();" style="width:620px; height:165px; word-wrap:break-word; border: 1px solid #aaa; border-radius: 3px; padding:4px;">'+e.bundle+'</textarea><button id="updraftplus-copy" class="button button-secondary" style="display: block;">'+uclion.copy_to_clipboard+"</button></div>")):console.log(e),e.hasOwnProperty("keys_table")&&jQuery("#updraftcentral_keys_content").append(e.keys_table),jQuery("#updraftcentral_wizard_go").show()}catch(r){alert(uclion.unexpectedresponse+" "+response),console.log(r)}},{error_callback:function(e,r,t,a){if(jQuery("#updraftcentral_keys").unblock(),"undefined"!=typeof a&&a.hasOwnProperty("fatal_error"))console.error(a.fatal_error_message),alert(a.fatal_error_message);else{var o="updraftcentral_send_command: error: "+r+" ("+t+")";console.log(o),alert(o),console.log(e)}}})}catch(n){jQuery("#updraft_central_key").html(),console.log(n)}});var a={};a[updraftlion.close]=function(){jQuery(this).dialog("close")},jQuery("#updraft-copy-modal").dialog({autoOpen:!1,resizeOnWindowResize:!0,scrollWithViewport:!0,resizeAccordingToViewport:!0,modal:!0,buttons:a}),jQuery("#updraftcentral_keys_content").on("click","#updraftplus-copy",function(e){e.preventDefault();var r=jQuery("#updraftcentral-key");r[0].value&&navigator.clipboard.writeText(r[0].value).then(function(){alert(uclion.key_copied)},function(e){jQuery("#updraft-copy-modal").dialog("open")})}),jQuery("#updraftcentral_keys").on("click",".updraftcentral_key_delete",function(e){e.preventDefault();var r=jQuery(this).data("key_id");return"undefined"==typeof r?void console.log("UpdraftPlus: .updraftcentral_key_delete clicked, but no key ID found"):(jQuery("#updraftcentral_keys").block({message:'<div style="margin: 8px; font-size:150%;"><img src="'+uclion.central_url+'/images/udlogo-rotating.gif" height="80" width="80" style="padding-bottom:10px;"><br>'+uclion.deleting+"</div>"}),void updraftcentral_send_command("delete_key",{key_id:r},function(e){jQuery("#updraftcentral_keys").unblock(),e.hasOwnProperty("keys_table")&&jQuery("#updraftcentral_keys_content").html(e.keys_table)},{error_callback:function(e,r,t,a){if(jQuery("#updraftcentral_keys").unblock(),"undefined"!=typeof a&&a.hasOwnProperty("fatal_error"))console.error(a.fatal_error_message),alert(a.fatal_error_message);else{var o="updraftcentral_send_command: error: "+r+" ("+t+")";console.log(o),alert(o),console.log(e)}}}))})});