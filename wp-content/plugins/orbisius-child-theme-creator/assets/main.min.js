var orbisius_child_theme_creator = { loader: function (e) { var t = jQuery(".orbisius_child_theme_creator_container .loader"); e ? jQuery(t).html("Please Wait ...").show() : jQuery(t).html("").hide() }, sanitize_file_name: function (e) { return e = (e = (e = (e = (e = (e = (e = e.replace(/[^\w\-\.\s\/\\]/gi, "")).replace(/\s+/gi, "-")).replace(/\.+/gi, ".")).replace(/-+/gi, "-")).replace(/_+/gi, "_")).replace(/^[._-]+/gi, "")).replace(/[._-]+$/gi, ""), e = jQuery.trim(e) }, delete_file: function (e, t) { jQuery.ajax({ type: "post", url: ajaxurl, data: jQuery(t).serialize() + "&action=orbisius_ctc_theme_editor_ajax&sub_cmd=" + escape("delete_file"), beforeSend: function () { orbisius_child_theme_creator.loader(1) }, complete: function () { orbisius_child_theme_creator.loader(0) }, success: function (e) { var _ = t.indexOf("theme_1") >= 0 ? 1 : 2; jQuery("#theme_" + _ + "_file option:selected").remove(), jQuery("#theme_" + _ + "_file").trigger("change") }, error: function () { alert("Cheating?") } }) } }; function orbisius_ctc_theme_editor_setup() { var e = jQuery, t = window.onbeforeunload; e(window).on("beforeunload", function (e) { var _ = ""; return jQuery("#theme_1_file_contents").data("orb_ctc_modified_content") ? _ = "Left Editor: Content was modified. Are you sure you want to leave without saving?" : jQuery("#theme_2_file_contents").data("orb_ctc_modified_content") && (_ = "Right Editor: Content was modified. Are you sure you want to leave without saving?"), "" != _ ? (e.returnValue = _, _) : void 0 !== t ? t(e) : void 0 }), "" != e("#theme_1").val() && app_load("#orbisius_ctc_theme_editor_theme_1_form", "generate_dropdown", "#theme_1_file", app_handle_theme_change), e("#theme_1_file_contents,#theme_2_file_contents").on("keyup keypress input paste", function (t) { var _ = { target: e(this), event: t }; jQuery(document).trigger("orbisius_child_theme_editor_event_content_updated", [_]) }), jQuery(document).on("orbisius_child_theme_editor_event_content_updated", function (e, t) { jQuery(t.target).data("orb_ctc_modified_content", 1), jQuery(t.target).addClass("modified_content") }), jQuery(document).on("orbisius_child_theme_editor_event_content_saved", function (e, t) { jQuery(t.target).removeData("orb_ctc_modified_content"), jQuery(t.target).removeClass("modified_content") }), e("#theme_1_delete_file_btn").on("click", function () { var t = e("#theme_1_file").val(); confirm("Delete: [" + t + "] ? Are you sure?", "") && orbisius_child_theme_creator.delete_file(t, "#orbisius_ctc_theme_editor_theme_1_form") }), e("#theme_2_delete_file_btn").on("click", function () { var t = e("#theme_2_file").val(); confirm("Delete: [" + t + "] ? Are you sure?", "") && orbisius_child_theme_creator.delete_file(t, "#orbisius_ctc_theme_editor_theme_2_form") }), e("#theme_1_new_file_btn").on("click", function () { e("#theme_1_new_file_container").toggle("slow"), e("#theme_1_new_file").focus() }), e("#theme_1_new_file").on("input", function (t) { var _ = e("#theme_1_new_file").val(); _ = orbisius_child_theme_creator.sanitize_file_name(_); var r = 1; if (e("#theme_1_file option").each(function () { e(this).val() != _ || (r = 0) }), r) e(".status", e("#theme_1_new_file_container")).text("").removeClass("app-alert-error"); else { e(".status", e("#theme_1_new_file_container")).text("File with that name already exists.").addClass("app-alert-error") } }), e("#theme_1_copy_file_btn").on("click", function () { e("#orbisius_copy_response_theme_1").html("").removeClass("updated").removeClass("error"), e(".orbisius_ctc_theme_editor_theme_1_files_list").toggle(), e(".orbisius_ctc_theme_editor_theme_1_files_list").is(":visible") && app_load("#orbisius_ctc_theme_editor_theme_1_form", "get_files", ".orbisius_ctc_theme_editor_theme_1_files_list_container", app_handle_theme_change) }), e("#theme_2_copy_file_btn").on("click", function () { e("#orbisius_copy_response_theme_2").html("").removeClass("updated").removeClass("error"), e(".orbisius_ctc_theme_editor_theme_2_files_list").toggle(), e(".orbisius_ctc_theme_editor_theme_2_files_list").is(":visible") && app_load("#orbisius_ctc_theme_editor_theme_2_form", "get_files", ".orbisius_ctc_theme_editor_theme_2_files_list_container", app_handle_theme_change) }), e("#theme_1_copy_files").on("click", function (e) { e.preventDefault(), app_load("#orbisius_ctc_theme_editor_theme_1_form", "copy_files", "#orbisius_copy_response_theme_1") }), e("#theme_2_copy_files").on("click", function (e) { e.preventDefault(), app_load("#orbisius_ctc_theme_editor_theme_2_form", "copy_files", "#orbisius_copy_response_theme_2") }), e("#theme_1_copy_files_cancel").on("click", function (t) { t.preventDefault(), e("#orbisius_copy_response_theme_1").html("").removeClass("updated").removeClass("error"), e(".orbisius_ctc_theme_editor_theme_1_files_list").toggle() }), e("#theme_2_copy_files_cancel").on("click", function (t) { t.preventDefault(), e("#orbisius_copy_response_theme_2").html("").removeClass("updated").removeClass("error"), e(".orbisius_ctc_theme_editor_theme_2_files_list").toggle() }), jQuery("body").on("click", ".orbisius_folder_list input", function (e) { if (jQuery(this).parent(".orbisius_file_label").length) jQuery(this).parent().toggleClass("bold"); else if (jQuery(this).parents(".orbisius_folder").length) { var t = jQuery(this)[0].checked, _ = jQuery(jQuery(this).parents(".orbisius_folder")[0]).find("label"), r = jQuery(jQuery(this).parents(".orbisius_folder")[0]).find("input"); t ? _.addClass("bold") : _.removeClass("bold"), t ? r.attr("checked", !0) : r.attr("checked", !1), jQuery(this).parents(".orbisius_folder").first().find(".orbisius_folder_list").toggle() } }), e("#theme_1_new_file_btn_ok").on("click", function () { var t = e("#theme_1_new_file").val(), _ = t = orbisius_child_theme_creator.sanitize_file_name(t); if ("" == t) return alert("Invalid or empty value for filename."), void e("#theme_1_new_file").focus(); var r = 1; if (e("#theme_1_file option").each(function () { e(this).val() != t || (r = 0) }), !r) return alert("File with that name already exists."), void e("#theme_1_new_file").focus(); e("select theme_1_file").prop("selected", !1); var i = e("<option></option>").val(t).html(_).prop("selected", !0); e("#theme_1_file").append(i), e("#theme_1_new_file_container").hide("slow"), e("#theme_1_new_file").val(""), e("#theme_1_file_contents").val("").focus(); var o = { file: t, file_selector: "#theme_1_file", content_selector: "#theme_1_file_contents" }; jQuery(document).trigger("orbisius_child_theme_editor_event_new_file", [o]) }), jQuery(document).on("orbisius_child_theme_editor_event_new_file", function (t, _) { e("html, body").animate({ scrollTop: jQuery(_.file_selector).offset().top - 50 }, 1e3) }), e("#theme_1_new_file_btn_cancel").on("click", function () { e("#theme_1_new_file").val(""), e("#theme_1_new_file_container").hide("slow"), e(".status", e("#theme_1_new_file_container")).text("").removeClass("app-alert-error") }), e("#theme_2_new_file_btn").on("click", function () { e("#theme_2_new_file_container").toggle("slow"), e("#theme_2_new_file").focus() }), e("#theme_2_new_file").on("input", function (t) { var _ = e("#theme_2_new_file").val(); _ = orbisius_child_theme_creator.sanitize_file_name(_); var r = 1; if (e("#theme_2_file option").each(function () { e(this).val() != _ || (r = 0) }), r) e(".status", e("#theme_2_new_file_container")).text("").removeClass("app-alert-error"); else { e(".status", e("#theme_2_new_file_container")).text("File with that name already exists.").addClass("app-alert-error") } }), e("#theme_2_new_file_btn_ok").on("click", function () { var t = e("#theme_2_new_file").val(), _ = t = orbisius_child_theme_creator.sanitize_file_name(t); if ("" == t) return alert("Invalid or empty value for filename."), void e("#theme_2_new_file").focus(); var r = 1; if (e("#theme_2_file option").each(function () { e(this).val() != t || (r = 0) }), !r) return alert("File with that name already exists."), void e("#theme_2_new_file").focus(); e("select theme_2_file").prop("selected", !1); var i = e("<option></option>").val(t).html(_).prop("selected", !0); e("#theme_2_file").append(i), e("#theme_2_new_file_container").hide("slow"), e("#theme_2_new_file").val(""), e("#theme_2_file_contents").val("").focus(); var o = { file: t, file_selector: "#theme_2_file", content_selector: "#theme_2_file_contents" }; jQuery(document).trigger("orbisius_child_theme_editor_event_new_file", [o]) }), e("#theme_2_new_file_btn_cancel").on("click", function () { e("#theme_2_new_file").val(""), e("#theme_2_new_file_container").hide("slow"), e(".status", e("#theme_2_new_file_container")).text("").removeClass("app-alert-error") }), e("#theme_1_syntax_chk_btn").on("click", function () { var e = ".orbisius_ctc_theme_editor_theme_1_primary_buttons .status"; jQuery(e).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Checking ..."), jQuery.ajax({ type: "post", url: ajaxurl, data: jQuery("#orbisius_ctc_theme_editor_theme_1_form").serialize() + "&action=orbisius_ctc_theme_editor_ajax&sub_cmd=" + escape("syntax_check"), beforeSend: function () { orbisius_child_theme_creator.loader(1) }, complete: function () { orbisius_child_theme_creator.loader(0) }, error: function () { alert("Cheating?") }, success: function (t) { jQuery(e).empty().removeClass("app-alert-notice").html(t.msg).addClass(t.status ? "app-alert-success" : "app-alert-error"), t.status && setTimeout(function () { jQuery(e).empty().removeClass("app-alert-success app-alert-error") }, 2e3) } }) }), e("#theme_2_syntax_chk_btn").on("click", function () { var e = ".orbisius_ctc_theme_editor_theme_2_primary_buttons .status"; jQuery(e).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Checking ..."), jQuery.ajax({ type: "post", url: ajaxurl, data: jQuery("#orbisius_ctc_theme_editor_theme_2_form").serialize() + "&action=orbisius_ctc_theme_editor_ajax&sub_cmd=" + escape("syntax_check"), beforeSend: function () { orbisius_child_theme_creator.loader(1) }, complete: function () { orbisius_child_theme_creator.loader(0) }, error: function () { alert("Cheating?") }, success: function (t) { jQuery(e).empty().removeClass("app-alert-notice").html(t.msg).addClass(t.status ? "app-alert-success" : "app-alert-error"), t.status && setTimeout(function () { jQuery(e).empty().removeClass("app-alert-success app-alert-error") }, 2e3) } }) }), e("#theme_1_send_btn").on("click", function () { e("#theme_1_send_container").toggle("slow"), e("#theme_1_send_to").focus() }), e("#theme_1_send_btn_cancel").on("click", function () { e("#theme_1_send_container").hide("slow") }), e("#theme_1_send_btn_ok").on("click", function () { var t = jQuery("#theme_1_send_to").val().trim(); if (-1 == t.indexOf("@") || t.indexOf(".") < 1) return alert("Invalid email(s)."), void e("#theme_1_send_to").focus(); var _ = ".orbisius_ctc_theme_editor_theme_1_primary_buttons .status"; jQuery(_).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Processing ..."), jQuery.ajax({ type: "post", url: ajaxurl, data: jQuery("#orbisius_ctc_theme_editor_theme_1_form").serialize() + "&action=orbisius_ctc_theme_editor_ajax&sub_cmd=" + escape("send_theme"), beforeSend: function () { orbisius_child_theme_creator.loader(1) }, complete: function () { orbisius_child_theme_creator.loader(0) }, error: function () { alert("Cheating?") }, success: function (t) { jQuery(_).empty().removeClass("app-alert-notice").html(t.msg).addClass(t.status ? "app-alert-success" : "app-alert-error"), t.status && setTimeout(function () { jQuery(_).empty().removeClass("app-alert-success app-alert-error"), e("#theme_1_send_btn_cancel").click() }, 2e3) } }) }), e("#theme_2_send_btn").on("click", function () { e("#theme_2_send_container").toggle("slow"), e("#theme_2_send_to").focus() }), e("#theme_2_send_btn_cancel").on("click", function () { e("#theme_2_send_container").hide("slow") }), e("#theme_2_send_btn_ok").on("click", function () { var t = jQuery("#theme_2_send_to").val().trim(); if (-1 == t.indexOf("@") || t.indexOf(".") < 1) return alert("Invalid email(s)."), void e("#theme_2_send_to").focus(); var _ = ".orbisius_ctc_theme_editor_theme_2_primary_buttons .status"; jQuery(_).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Processing ..."), jQuery.ajax({ type: "post", url: ajaxurl, data: jQuery("#orbisius_ctc_theme_editor_theme_2_form").serialize() + "&action=orbisius_ctc_theme_editor_ajax&sub_cmd=" + escape("send_theme"), beforeSend: function () { orbisius_child_theme_creator.loader(1) }, complete: function () { orbisius_child_theme_creator.loader(0) }, error: function () { alert("Cheating?") }, success: function (t) { jQuery(_).empty().removeClass("app-alert-notice").html(t.msg).addClass(t.status ? "app-alert-success" : "app-alert-error"), t.status && setTimeout(function () { jQuery(_).empty().removeClass("app-alert-success app-alert-error"), e("#theme_2_send_btn_cancel").click() }, 2e3) } }) }), e("#theme_1_new_folder_btn").on("click", function () { e("#theme_1_new_folder_container").toggle("slow"), e("#theme_1_new_folder").focus() }), e("#theme_2_new_folder_btn").on("click", function () { e("#theme_2_new_folder_container").toggle("slow"), e("#theme_2_new_folder").focus() }), e("#theme_1_new_folder").on("input", function (t) { var _ = e("#theme_1_new_folder").val(); _ = orbisius_child_theme_creator.sanitize_file_name(_); var r = 1; if (e("#theme_1_file option").each(function () { e(this).val() != _ || (r = 0) }), r) e(".status", e("#theme_1_new_folder_container")).text("").removeClass("app-alert-error"); else { e(".status", e("#theme_1_new_folder_container")).text("File/folder with that name already exists.").addClass("app-alert-error") } }), e("#theme_2_new_folder").on("input", function (t) { var _ = e("#theme_2_new_folder").val(); _ = orbisius_child_theme_creator.sanitize_file_name(_); var r = 1; if (e("#theme_2_file option").each(function () { e(this).val() != _ || (r = 0) }), r) e(".status", e("#theme_2_new_folder_container")).text("").removeClass("app-alert-error"); else { e(".status", e("#theme_2_new_folder_container")).text("File/folder with that name already exists.").addClass("app-alert-error") } }), e("#theme_1_new_folder_btn_ok").on("click", function () { var t = e("#theme_1_new_folder").val(), _ = t = orbisius_child_theme_creator.sanitize_file_name(t); if ("" == t) return alert("Invalid or empty value for folder name."), void e("#theme_1_new_folder").focus(); var r = 1; if (e("#theme_1_folder option").each(function () { e(this).val() != t || (r = 0) }), !r) return alert("File with that name already exists."), void e("#theme_1_new_folder").focus(); e("select theme_1_folder").prop("selected", !1); var i = e("<option></option>").val(t).html(_).prop("selected", !0); e("#theme_1_folder").append(i), e("#theme_1_new_folder_container").hide("slow"), e("#theme_1_new_folder").val(""), e("#theme_1_folder_contents").val("").focus() }), e("#theme_1_new_folder_btn_cancel").on("click", function () { e("#theme_1_new_folder").val(""), e("#theme_1_new_folder_container").hide("slow"), e(".status", e("#theme_1_new_folder_container")).text("").removeClass("app-alert-error") }), e("#theme_2_new_folder_btn_ok").on("click", function () { var t = e("#theme_2_new_folder").val(), _ = t = orbisius_child_theme_creator.sanitize_file_name(t); if ("" == t) return alert("Invalid or empty value for folder name."), void e("#theme_2_new_folder").focus(); var r = 1; if (e("#theme_2_folder option").each(function () { e(this).val() != t || (r = 0) }), !r) return alert("File with that name already exists."), void e("#theme_2_new_folder").focus(); e("select theme_2_folder").prop("selected", !1); var i = e("<option></option>").val(t).html(_).prop("selected", !0); e("#theme_2_folder").append(i), e("#theme_2_new_folder_container").hide("slow"), e("#theme_2_new_folder").val(""), e("#theme_2_folder_contents").val("").focus() }), e("#theme_2_new_folder_btn_cancel").on("click", function () { e("#theme_2_new_folder").val(""), e("#theme_2_new_folder_container").hide("slow"), e(".status", e("#theme_2_new_folder_container")).text("").removeClass("app-alert-error") }), e("#theme_1").on("change", function () { app_load("#orbisius_ctc_theme_editor_theme_1_form", "generate_dropdown", "#theme_1_file", app_handle_theme_change), e(".orbisius_ctc_theme_editor_theme_1_files_list").is(":visible") && app_load("#orbisius_ctc_theme_editor_theme_1_form", "get_files", ".orbisius_ctc_theme_editor_theme_1_files_list_container", app_handle_theme_change) }), e("#theme_2").on("change", function () { app_load("#orbisius_ctc_theme_editor_theme_2_form", "generate_dropdown", "#theme_2_file", app_handle_theme_change), e(".orbisius_ctc_theme_editor_theme_2_files_list").is(":visible") && app_load("#orbisius_ctc_theme_editor_theme_2_form", "get_files", ".orbisius_ctc_theme_editor_theme_2_files_list_container", app_handle_theme_change) }), e("#orbisius_ctc_theme_editor_theme_1_form").submit(function (e) { return app_load("#orbisius_ctc_theme_editor_theme_1_form", "save_file", "#theme_1_file_contents"), !1 }), "" != e("#theme_2").val() && app_load("#orbisius_ctc_theme_editor_theme_2_form", "generate_dropdown", "#theme_2_file", app_handle_theme_change), e("#theme_2").on("change", function () { app_load("#orbisius_ctc_theme_editor_theme_2_form", "generate_dropdown", "#theme_2_file", app_handle_theme_change) }), e("#orbisius_ctc_theme_editor_theme_2_form").submit(function () { return app_load("#orbisius_ctc_theme_editor_theme_2_form", "save_file", "#theme_2_file_contents"), !1 }) } function app_handle_theme_change(e, t, _, r) { var i = jQuery(e) ? jQuery(e).attr("id") : ""; if ("" != (i = i || "")) { if (i = "#" + (i = i.replace(/.+(theme[-_]*\d+).*/, "$1")) + "_", "undefined" != typeof OrbisiusChildThemeCreatorExt && void 0 !== OrbisiusChildThemeCreatorExt.Editors && void 0 !== OrbisiusChildThemeCreatorExt.Editors.onThemeChange) { var o = (o = i).replace(/_+$/g, ""); OrbisiusChildThemeCreatorExt.Editors.onThemeChange(o, jQuery(o).val()) } "" !== jQuery(i + "_file").val() && app_load(e, "load_file", i + "file_contents"), jQuery(i + "file").on("change", function () { app_load(e, "load_file", i + "file_contents") }) } } function app_load(e, t, _, r) { var i = '<span class="app-alert-notice">Loading...</span>', o = t.indexOf("save") >= 0; o ? (jQuery(_).is("input,textarea") && (jQuery(_).attr("readonly", "readonly"), jQuery(_).addClass("saving_action")), jQuery(".status", jQuery(_).parent()).html(i)) : jQuery(_).is("input,textarea") ? jQuery(_).addClass("saving_action") : jQuery(_).is("select") ? jQuery(_ + " option").text("Loading...") : jQuery(_).html(i); var a = jQuery(e).serialize(); if ("copy_files" === t) { var n = jQuery(_).parent().find(".orb_files:checked").map(function () { return jQuery(this).val() }).get(), s = "1" === _.substr(-1) ? "#theme_2" : "#theme_1"; a += "&copy=" + (n = encodeURIComponent(JSON.stringify(n))), a += "&copy_to=" + encodeURIComponent(jQuery(s).val()) } jQuery.ajax({ type: "post", url: ajaxurl, data: a + "&action=orbisius_ctc_theme_editor_ajax&sub_cmd=" + escape(t), success: function (i) { var a = { form_id: e, sub_cmd: t, result: i }; if ("" != i) { if ("copy_files" === t && "Missing data!" !== i) { var n = (i = JSON.parse(i)).status ? "updated" : "error"; return jQuery(_).removeClass("success").removeClass("error").addClass(n), void jQuery(_).html(i.message) } if (jQuery(_).is("input,textarea") ? (jQuery(_).val(i), jQuery(_).is("textarea") && jQuery(_).trigger("orbisius_child_theme_editor_event_file_loaded", a)) : (jQuery(_).html(i), jQuery(_).trigger("orbisius_child_theme_editor_event_content_loaded", a)), o) { jQuery(".status", jQuery(_).parent()).html("Saved.").addClass("app-alert-success"), setTimeout(function () { jQuery(".status", jQuery(_).parent()).empty().removeClass("app-alert-success app-alert-error") }, 2e3); a = { target: jQuery(_), event: {} }; jQuery(document).trigger("orbisius_child_theme_editor_event_content_saved", [a]) } } else o && jQuery(".status", jQuery(_).parent()).html("Oops. Cannot save.").addClass("app-alert-error"); void 0 !== r && r(e, t, _, i) }, beforeSend: function () { orbisius_child_theme_creator.loader(1) }, complete: function (e) { orbisius_child_theme_creator.loader(0), jQuery(_).removeClass("saving_action"), o && jQuery(_).is("input,textarea") && jQuery(_).removeAttr("readonly") }, error: function () { alert("Cheating?") } }) } jQuery(document).ready(function (e) { orbisius_ctc_theme_editor_setup() });