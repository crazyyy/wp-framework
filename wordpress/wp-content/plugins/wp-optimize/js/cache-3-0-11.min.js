var WP_Optimize_Cache=function(e){function o(){var e={};return t(".cache-settings").each(function(){var o=t(this),a=o.attr("name");o.is('input[type="checkbox"]')?e[a]=o.is(":checked")?1:0:o.is("textarea")?e[a]=o.val().split("\n"):e[a]=o.val()}),e}function a(){d||(d=setInterval(function(){s()},5e3))}function s(){e("get_cache_preload_status",null,function(e){e.done?(_.val(wpoptimize.run_now),_.data("running",!1),clearInterval(d),d=null):(_.val(wpoptimize.cancel),_.data("running",!0)),l.text(e.message),r(e)})}function r(e){t("#wpo_current_cache_size_information").text(wpoptimize.current_cache_size+" "+e.size),t("#wpo_current_cache_file_count").text(wpoptimize.number_of_files+" "+e.file_count)}var t=jQuery,i=t("#wp_optimize_browser_cache_enable"),n=t("#wp-optimize-purge-cache"),p=t("#enable_page_caching"),c=t("#page_cache_length_value");n.click(function(){var o=t(this),s=o.next(),i=s.next();s.show(),e("purge_page_cache",{},function(e){s.hide(),i.show(),setTimeout(function(){i.fadeOut("slow",function(){i.hide()}),a()},5e3),r(e)})}),i.closest("form").submit(function(e){return e.preventDefault(),i.trigger("click"),!1}),c.on("change",function(){var e=parseInt(c.val(),10);t('#preload_schedule_type option[value="wpo_use_cache_lifespan"]').prop("disabled",isNaN(e)||e<=0)}),t("#wp_optimize_gzip_compression_enable").on("click",function(){var o=t(this),a=o.next();a.show(),e("enable_gzip_compression",{enable:o.data("enable")},function(e){var s=t("#wpo_gzip_compression_status");e?(e.enabled?(o.text(wpoptimize.disable),o.data("enable","0"),s.removeClass("wpo-disabled").addClass("wpo-enabled")):(o.text(wpoptimize.enable),o.data("enable","1"),s.addClass("wpo-disabled").removeClass("wpo-enabled")),e.message?t("#wpo_gzip_compression_error_message").text(e.message).show():t("#wpo_gzip_compression_error_message").hide(),e.output?t("#wpo_gzip_compression_output").html(e.output).show():t("#wpo_gzip_compression_output").hide()):alert(wpoptimize.error_unexpected_response),a.hide()}).fail(function(){alert(wpoptimize.error_unexpected_response),a.hide()})}),t(".wpo-refresh-gzip-status").on("click",function(o){o.preventDefault(),$link=t(this),$link.addClass("loading"),e("get_gzip_compression_status",null,function(e){$link.removeClass("loading");var o=t("#wpo_gzip_compression_status");e.hasOwnProperty("status")?e.status?o.removeClass("wpo-disabled").addClass("wpo-enabled"):o.addClass("wpo-disabled").removeClass("wpo-enabled"):e.hasOwnProperty("error")&&(alert(e.error),console.log("Gzip status error code: "+e.code),console.log("Gzip status error message: "+e.message))})}),i.on("click",function(){var o=t("#wpo_browser_cache_expire_days"),a=t("#wpo_browser_cache_expire_hours"),s=parseInt(o.val(),10),r=parseInt(a.val(),10),i=t(this),n=i.next();return isNaN(s)&&(s=0),isNaN(r)&&(r=0),s<0||r<0?(t("#wpo_browser_cache_error_message").text(wpoptimize.please_use_positive_integers).show(),!1):r>23?(t("#wpo_browser_cache_error_message").text(wpoptimize.please_use_valid_values).show(),!1):(t("#wpo_browser_cache_error_message").hide(),o.val(s),a.val(r),n.show(),void e("enable_browser_cache",{browser_cache_expire_days:s,browser_cache_expire_hours:r},function(e){var o=t("#wpo_browser_cache_status");e?(e.enabled?(i.text(wpoptimize.update),o.removeClass("wpo-disabled").addClass("wpo-enabled")):(i.text(wpoptimize.enable),o.addClass("wpo-disabled").removeClass("wpo-enabled")),e.message?t("#wpo_browser_cache_message").text(e.message).show():t("#wpo_browser_cache_message").hide(),e.error_message?t("#wpo_browser_cache_error_message").text(e.error_message).show():t("#wpo_browser_cache_error_message").hide(),e.output?t("#wpo_browser_cache_output").html(e.output).show():t("#wpo_browser_cache_output").hide()):alert(wpoptimize.error_unexpected_response),n.hide()}).fail(function(){alert(wpoptimize.error_unexpected_response),n.hide()}))}),t("#wp-optimize-save-cache-settings, #wp-optimize-save-cache-advanced-rules, #wp-optimize-save-cache-preload-settings").click(function(){var a=t(this),s=a.next(),r=s.next();s.show(),t.blockUI(),e("save_cache_settings",{"cache-settings":o()},function(e){e.hasOwnProperty("error")?(console.log(e.error),t(".wpo-error__enabling-cache").removeClass("wpo_hidden").find("p").text(e.error.message)):t(".wpo-error__enabling-cache").addClass("wpo_hidden").find("p").text(""),t.unblockUI(),s.hide(),p.prop("checked",e.enabled),r.show(),p.is(":checked")?(t(".purge-cache").show(),t("#wp_optimize_run_cache_preload").removeProp("disabled")):(t(".purge-cache").hide(),t("#wp_optimize_run_cache_preload").prop("disabled",!0)),setTimeout(function(){r.fadeOut("slow",function(){r.hide()})},5e3)})}),p.on("change",function(){t("#wp-optimize-save-cache-settings").trigger("click")});var _=t("#wp_optimize_run_cache_preload"),l=t("#wp_optimize_preload_cache_status"),d=null,u=t("#enable_schedule_preload"),w=t("#preload_schedule_type");u.change(function(){u.prop("checked")?w.prop("disabled",!1):w.prop("disabled",!0)}),u.trigger("change"),_.on("click",function(){var o=t(this),s=o.data("running"),r=l.text();o.prop("disabled",!0),s?(o.data("running",!1),clearInterval(d),d=null,e("cancel_cache_preload",null,function(e){e&&e.hasOwnProperty("message")&&l.text(e.message)}).always(function(){o.val(wpoptimize.run_now),o.prop("disabled",!1)})):(l.text(wpoptimize.starting_preload),o.data("running",!0),e("run_cache_preload",null,null,!0,{timeout:3e3}).always(function(e){try{var s=wpo_parse_json(e)}catch(t){}return s&&s.error?(alert(s.error),l.text(r),o.prop("disabled",!1),void o.data("running",!1)):(l.text(wpoptimize.loading_urls),o.val(wpoptimize.cancel),o.prop("disabled",!1),void a())}))}),_.data("running")&&a()};